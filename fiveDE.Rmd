# (PART) FiveDE Index {-}

# Identification of the Disempowered

```{r message=FALSE, warning=FALSE, echo=FALSE}
source("_common.R")

nonzero <- function(x) sum(x != 0)

load("_data/packages.RData")
load("_data/globalSetup.RData")

library(tidyverse)

```

## Methodology
```{block, type="tmbinfo", echo=TRUE}

1. Method 1 focuses on the percentage of empowered women and adequacies among the disempowered. 
2. Method 2 focuses on the percentage of disempowered women and the percentage of domains in which they lack adequate achievements. Involves **Censoring the Inadequacies**.

> Method 2 is commonly used as it is consistent with the M0 measurement (Alkire and Foster 2011).


> Note: A respondent is identified as disempowered if ci > k and empowered if ci ≤ k. 
> Censoring: If ci ≤ k the score is replaced by 0, otherwise cik = ci, d01k = d01, d02k = d02, and so forth.



<!-- ```{block, type="tmbalert", echo=TRUE} -->

 ![ci inadequacy score](_figs/FiveDE.png)
<!-- Example -->

<!-- * WEAI indicators = 10 -->
<!-- * A-WEAI indicators = 6 -->
<!-- * pro-WEAI indicators = 12 -->
<!-- * HERS-EA Poultry Project indicators = 10 (Author constructed) -->
```


<br><hr><br>


## Results

### Whole dataset
```{r}
uncensored <- readRDS("_data/all_depr_wted_indicators_ciw_var.rds")
saveRDS(uncensored, "_data/uncensored.rds")

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0


ciM0 <- round(mean(uncensored$ci), 3)
d01Hn <- round(mean(uncensored$d01), 3)
d02Hn <- round(mean(uncensored$d02), 3)
d03Hn <- round(mean(uncensored$d03), 3)
d04Hn <- round(mean(uncensored$d04), 3)
d05Hn <- round(mean(uncensored$d05), 3)
d06Hn <- round(mean(uncensored$d06), 3)
d07Hn <- round(mean(uncensored$d07), 3)
d08Hn <- round(mean(uncensored$d08), 3)
d09Hn <- round(mean(uncensored$d09), 3)
d10Hn <- round(mean(uncensored$d10), 3)

uncensoredM0Index <- sum(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn)
uncensoredFiveDE <- 1-uncensoredM0Index

Uncensored <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

paste("IndicatorSum =", round(uncensoredM0Index, digits = 2))
paste("M0 =", round(ciM0, digits = 2))
cat("\nStatus:", ifelse(round(uncensoredM0Index, digits = 2) == round(ciM0, digits = 2), "PASSED", "FAILED"))

library(dplyr)
uncensored <- readRDS("_data/uncensored.rds")

# Set empowerment cutoff (k)
k = 0.2

censored = uncensored %>%
  mutate(
    cik = ifelse(ci<= k, 0, ci),
    d01k = ifelse(ci<= k, 0, d01),
    d02k = ifelse(ci<= k, 0, d02),
    d03k = ifelse(ci<= k, 0, d03),
    d04k = ifelse(ci<= k, 0, d04),
    d05k = ifelse(ci<= k, 0, d05),
    d06k = ifelse(ci<= k, 0, d06),
    d07k = ifelse(ci<= k, 0, d07),
    d08k = ifelse(ci<= k, 0, d08),
    d09k = ifelse(ci<= k, 0, d09),
    d10k = ifelse(ci<= k, 0, d10)
)

saveRDS(censored, ("_data/censored.rds"))
write_delim(censored, "_data/censored.csv", delim = ",")

censored <-(readRDS("_data/censored.rds"))

Hn <- mean(censored$cik)
cikM0 <- Hn
indexFiveDE <- 1 - cikM0


cikM0 <- round(mean(censored$cik), 3)
d01kHn <- round(mean(censored$d01k), 3)
d02kHn <- round(mean(censored$d02k), 3)
d03kHn <- round(mean(censored$d03k), 3)
d04kHn <- round(mean(censored$d04k), 3)
d05kHn <- round(mean(censored$d05k), 3)
d06kHn <- round(mean(censored$d06k), 3)
d07kHn <- round(mean(censored$d07k), 3)
d08kHn <- round(mean(censored$d08k), 3)
d09kHn <- round(mean(censored$d09k), 3)
d10kHn <- round(mean(censored$d10k), 3)

censoredM0Index <- sum(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn)
censoredFiveDE <- 1-censoredM0Index

Censored <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

paste("IndicatorSum =", round(censoredM0Index, digits = 2))
paste("M0 =", round(cikM0, digits = 2))
cat("\nStatus:", ifelse(round(censoredM0Index, digits = 2) == round(cikM0, digits = 2), "PASSED", "FAILED"))

### Tabulation and Plotting

IndicatorName <- c("Poultry  Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "Disempowered (M0)", "Empowered (5DE)" )
IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )

HCRatio <- data.frame(Indicator, Uncensored, Censored)

HCRatio %>% head(12) %>% kable("html") %>% kable_styling(bootstrap_options = "basic", full_width = FALSE)

library(dplyr)
library(viridis)

p1 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "stack", width = .5, color = "#f1f1f1") + 
  labs(x = "Disempowerment Index", y = "Absolute Contribution", title = "", fill = "ColorCode") + 
  theme(axis.title.x = element_text(vjust = -1.5))

p2 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "fill", width = .5, color = "#f1f1f1") +
  labs(x = "Disempowerment Index", y = "Relative Contribution", title = "", fill = "Colorcode") +
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.title.x = element_text(vjust = -1.5))

# ggpubr::ggarrange(p1, p2, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")
```



### Phase 1
```{r}
uncensored <- (readRDS("_data/uncensored.rds") %>% filter(Phase == "P1"))

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

ciM0 <- round(mean(uncensored$ci), 3)
d01Hn <- round(mean(uncensored$d01), 3)
d02Hn <- round(mean(uncensored$d02), 3)
d03Hn <- round(mean(uncensored$d03), 3)
d04Hn <- round(mean(uncensored$d04), 3)
d05Hn <- round(mean(uncensored$d05), 3)
d06Hn <- round(mean(uncensored$d06), 3)
d07Hn <- round(mean(uncensored$d07), 3)
d08Hn <- round(mean(uncensored$d08), 3)
d09Hn <- round(mean(uncensored$d09), 3)
d10Hn <- round(mean(uncensored$d10), 3)

uncensoredM0Index <- sum(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn)
uncensoredFiveDE <- 1-uncensoredM0Index

# UncensoredP1 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

paste("IndicatorSum =", round(uncensoredM0Index, digits = 2))
paste("M0 =", round(ciM0, digits = 2))
cat("\nStatus:", ifelse(round(uncensoredM0Index, digits = 2) == round(ciM0, digits = 2), "PASSED", "FAILED"))

# ### Censoring the Inadequacies
# >Note: A respondent is identified as disempowered if ci > k and empowered if ci ≤ k. 
# > Censoring: If ci <= k the score is replaced by 0.")

library(dplyr)
censored <- (readRDS("_data/censored.rds") %>% filter(Phase == "P1"))
Hn <- mean(censored$cik)
cikM0 <- Hn
indexFiveDE <- 1 - cikM0

cikM0 <- round(mean(censored$cik), 3)
d01kHn <- round(mean(censored$d01k), 3)
d02kHn <- round(mean(censored$d02k), 3)
d03kHn <- round(mean(censored$d03k), 3)
d04kHn <- round(mean(censored$d04k), 3)
d05kHn <- round(mean(censored$d05k), 3)
d06kHn <- round(mean(censored$d06k), 3)
d07kHn <- round(mean(censored$d07k), 3)
d08kHn <- round(mean(censored$d08k), 3)
d09kHn <- round(mean(censored$d09k), 3)
d10kHn <- round(mean(censored$d10k), 3)

censoredM0Index <- sum(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn)
censoredFiveDE <- 1-censoredM0Index

# CensoredP1 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

paste("IndicatorSum =", round(censoredM0Index, digits = 2))
paste("M0 =", round(cikM0, digits = 2))
cat("\nStatus:", ifelse(round(censoredM0Index, digits = 2) == round(cikM0, digits = 2), "PASSED", "FAILED"))

### Tabulation and Plotting

IndicatorName <- c("Poultry  Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "Disempowered (M0)", "Empowered (5DE)" )
IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

UncensoredP1 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

CensoredP1 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

HCRatio <- data.frame(Indicator, UncensoredP1, CensoredP1)

HCRatio %>% head(12) %>% kable("html") %>% kable_styling(bootstrap_options = "basic", full_width = FALSE)


library(dplyr)
library(viridis)

p3 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "stack", width = .5, color = "#f1f1f1") + 
  labs(x = "Disempowerment Index", y = "Absolute Contribution", title = "", fill = "ColorCode") + 
  theme(axis.title.x = element_text(vjust = -1.5))

p4 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "fill", width = .5, color = "#f1f1f1") +
  labs(x = "Disempowerment Index", y = "Relative Contribution", title = "", fill = "Colorcode") +
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.title.x = element_text(vjust = -1.5))

# ggpubr::ggarrange(p1, p2, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")
```




<br>

### Women Phase 1
```{r}
uncensored <- (readRDS("_data/uncensored.rds") %>% filter(Phase == "P1", Sex == 2))

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

ciM0 <- round(mean(uncensored$ci), 3)
d01Hn <- round(mean(uncensored$d01), 3)
d02Hn <- round(mean(uncensored$d02), 3)
d03Hn <- round(mean(uncensored$d03), 3)
d04Hn <- round(mean(uncensored$d04), 3)
d05Hn <- round(mean(uncensored$d05), 3)
d06Hn <- round(mean(uncensored$d06), 3)
d07Hn <- round(mean(uncensored$d07), 3)
d08Hn <- round(mean(uncensored$d08), 3)
d09Hn <- round(mean(uncensored$d09), 3)
d10Hn <- round(mean(uncensored$d10), 3)

uncensoredM0Index <- sum(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn)
uncensoredFiveDE <- 1-uncensoredM0Index

# UncensoredP1 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

paste("IndicatorSum =", round(uncensoredM0Index, digits = 2))
paste("M0 =", round(ciM0, digits = 2))
cat("\nStatus:", ifelse(round(uncensoredM0Index, digits = 2) == round(ciM0, digits = 2), "PASSED", "FAILED"))

# ### Censoring the Inadequacies
# >Note: A respondent is identified as disempowered if ci > k and empowered if ci ≤ k. 
# > Censoring: If ci <= k the score is replaced by 0.")

library(dplyr)
censored <- (readRDS("_data/censored.rds") %>% filter(Phase == "P1", Sex == 2))
Hn <- mean(censored$cik)
cikM0 <- Hn
indexFiveDE <- 1 - cikM0

cikM0 <- round(mean(censored$cik), 3)
d01kHn <- round(mean(censored$d01k), 3)
d02kHn <- round(mean(censored$d02k), 3)
d03kHn <- round(mean(censored$d03k), 3)
d04kHn <- round(mean(censored$d04k), 3)
d05kHn <- round(mean(censored$d05k), 3)
d06kHn <- round(mean(censored$d06k), 3)
d07kHn <- round(mean(censored$d07k), 3)
d08kHn <- round(mean(censored$d08k), 3)
d09kHn <- round(mean(censored$d09k), 3)
d10kHn <- round(mean(censored$d10k), 3)

censoredM0Index <- sum(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn)
censoredFiveDE <- 1-censoredM0Index

# CensoredP1 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

paste("IndicatorSum =", round(censoredM0Index, digits = 2))
paste("M0 =", round(cikM0, digits = 2))
cat("\nStatus:", ifelse(round(censoredM0Index, digits = 2) == round(cikM0, digits = 2), "PASSED", "FAILED"))

### Tabulation and Plotting

IndicatorName <- c("Poultry  Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "Disempowered (M0)", "Empowered (5DE)" )
IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

UncensoredP1F <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

CensoredP1F <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

HCRatio <- data.frame(Indicator, UncensoredP1F, CensoredP1F)

HCRatio %>% head(12) %>% kable("html") %>% kable_styling(bootstrap_options = "basic", full_width = FALSE)


library(dplyr)
library(viridis)

p5 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "stack", width = .5, color = "#f1f1f1") + 
  labs(x = "Disempowerment Index", y = "Absolute Contribution", title = "", fill = "ColorCode") + 
  theme(axis.title.x = element_text(vjust = -1.5))

p6 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "fill", width = .5, color = "#f1f1f1") +
  labs(x = "Disempowerment Index", y = "Relative Contribution", title = "", fill = "Colorcode") +
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.title.x = element_text(vjust = -1.5))

# ggpubr::ggarrange(p5, p6, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")
```

<br>



<br>

### Men Phase 1

```{r}
uncensored <- (readRDS("_data/uncensored.rds") %>% filter(Phase == "P1", Sex == 1))

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

ciM0 <- round(mean(uncensored$ci), 3)
d01Hn <- round(mean(uncensored$d01), 3)
d02Hn <- round(mean(uncensored$d02), 3)
d03Hn <- round(mean(uncensored$d03), 3)
d04Hn <- round(mean(uncensored$d04), 3)
d05Hn <- round(mean(uncensored$d05), 3)
d06Hn <- round(mean(uncensored$d06), 3)
d07Hn <- round(mean(uncensored$d07), 3)
d08Hn <- round(mean(uncensored$d08), 3)
d09Hn <- round(mean(uncensored$d09), 3)
d10Hn <- round(mean(uncensored$d10), 3)

uncensoredM0Index <- sum(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn)
uncensoredFiveDE <- 1-uncensoredM0Index

# UncensoredP1 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

paste("IndicatorSum =", round(uncensoredM0Index, digits = 2))
paste("M0 =", round(ciM0, digits = 2))
cat("\nStatus:", ifelse(round(uncensoredM0Index, digits = 2) == round(ciM0, digits = 2), "PASSED", "FAILED"))

# ### Censoring the Inadequacies
# >Note: A respondent is identified as disempowered if ci > k and empowered if ci ≤ k. 
# > Censoring: If ci <= k the score is replaced by 0.")

library(dplyr)
censored <- (readRDS("_data/censored.rds") %>% filter(Phase == "P1", Sex == 2))
Hn <- mean(censored$cik)
cikM0 <- Hn
indexFiveDE <- 1 - cikM0

cikM0 <- round(mean(censored$cik), 3)
d01kHn <- round(mean(censored$d01k), 3)
d02kHn <- round(mean(censored$d02k), 3)
d03kHn <- round(mean(censored$d03k), 3)
d04kHn <- round(mean(censored$d04k), 3)
d05kHn <- round(mean(censored$d05k), 3)
d06kHn <- round(mean(censored$d06k), 3)
d07kHn <- round(mean(censored$d07k), 3)
d08kHn <- round(mean(censored$d08k), 3)
d09kHn <- round(mean(censored$d09k), 3)
d10kHn <- round(mean(censored$d10k), 3)

censoredM0Index <- sum(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn)
censoredFiveDE <- 1-censoredM0Index

# CensoredP1 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

paste("IndicatorSum =", round(censoredM0Index, digits = 2))
paste("M0 =", round(cikM0, digits = 2))
cat("\nStatus:", ifelse(round(censoredM0Index, digits = 2) == round(cikM0, digits = 2), "PASSED", "FAILED"))

### Tabulation and Plotting

IndicatorName <- c("Poultry  Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "Disempowered (M0)", "Empowered (5DE)" )
IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

UncensoredP1M <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

CensoredP1M <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

HCRatio <- data.frame(Indicator, UncensoredP1M, CensoredP1M)

HCRatio %>% head(12) %>% kable("html") %>% kable_styling(bootstrap_options = "basic", full_width = FALSE)


library(dplyr)
library(viridis)

p7 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "stack", width = .5, color = "#f1f1f1") + 
  labs(x = "Disempowerment Index", y = "Absolute Contribution", title = "", fill = "ColorCode") + 
  theme(axis.title.x = element_text(vjust = -1.5))

p8 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "fill", width = .5, color = "#f1f1f1") +
  labs(x = "Disempowerment Index", y = "Relative Contribution", title = "", fill = "Colorcode") +
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.title.x = element_text(vjust = -1.5))

# ggpubr::ggarrange(p7, p8, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")
```


<br>



<br>
<br>

### Phase 2
```{r}
uncensored <- (readRDS("_data/uncensored.rds") %>% filter(Phase == "P2"))

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

ciM0 <- round(mean(uncensored$ci), 3)
d01Hn <- round(mean(uncensored$d01), 3)
d02Hn <- round(mean(uncensored$d02), 3)
d03Hn <- round(mean(uncensored$d03), 3)
d04Hn <- round(mean(uncensored$d04), 3)
d05Hn <- round(mean(uncensored$d05), 3)
d06Hn <- round(mean(uncensored$d06), 3)
d07Hn <- round(mean(uncensored$d07), 3)
d08Hn <- round(mean(uncensored$d08), 3)
d09Hn <- round(mean(uncensored$d09), 3)
d10Hn <- round(mean(uncensored$d10), 3)

uncensoredM0Index <- sum(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn)
uncensoredFiveDE <- 1-uncensoredM0Index

# UncensoredP2 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

paste("IndicatorSum =", round(uncensoredM0Index, digits = 2))
paste("M0 =", round(ciM0, digits = 2))
cat("\nStatus:", ifelse(round(uncensoredM0Index, digits = 2) == round(ciM0, digits = 2), "PASSED", "FAILED"))

# ### Censoring the Inadequacies
# >Note: A respondent is identified as disempowered if ci > k and empowered if ci ≤ k. 
# > Censoring: If ci <= k the score is replaced by 0.")

library(dplyr)
censored <- (readRDS("_data/censored.rds") %>% filter(Phase == "P2"))
Hn <- mean(censored$cik)
cikM0 <- Hn
indexFiveDE <- 1 - cikM0

cikM0 <- round(mean(censored$cik), 3)
d01kHn <- round(mean(censored$d01k), 3)
d02kHn <- round(mean(censored$d02k), 3)
d03kHn <- round(mean(censored$d03k), 3)
d04kHn <- round(mean(censored$d04k), 3)
d05kHn <- round(mean(censored$d05k), 3)
d06kHn <- round(mean(censored$d06k), 3)
d07kHn <- round(mean(censored$d07k), 3)
d08kHn <- round(mean(censored$d08k), 3)
d09kHn <- round(mean(censored$d09k), 3)
d10kHn <- round(mean(censored$d10k), 3)

censoredM0Index <- sum(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn)
censoredFiveDE <- 1-censoredM0Index

# CensoredP2 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

paste("IndicatorSum =", round(censoredM0Index, digits = 2))
paste("M0 =", round(cikM0, digits = 2))
cat("\nStatus:", ifelse(round(censoredM0Index, digits = 2) == round(cikM0, digits = 2), "PASSED", "FAILED"))

### Tabulation and Plotting

IndicatorName <- c("Poultry  Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "Disempowered (M0)", "Empowered (5DE)" )
IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

UncensoredP2 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

CensoredP2 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

HCRatio <- data.frame(Indicator, UncensoredP2, CensoredP2)

HCRatio %>% head(12) %>% kable("html") %>% kable_styling(bootstrap_options = "basic", full_width = FALSE)


library(dplyr)
library(viridis)

p9 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "stack", width = .5, color = "#f1f1f1") + 
  labs(x = "Disempowerment Index", y = "Absolute Contribution", title = "", fill = "ColorCode") + 
  theme(axis.title.x = element_text(vjust = -1.5))

p10 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "fill", width = .5, color = "#f1f1f1") +
  labs(x = "Disempowerment Index", y = "Relative Contribution", title = "", fill = "Colorcode") +
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.title.x = element_text(vjust = -1.5))

# ggpubr::ggarrange(p9, p10, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")
```

<br>

### Women Phase 2
```{r}
uncensored <- (readRDS("_data/uncensored.rds") %>% filter(Phase == "P2", Sex == 2))

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

ciM0 <- round(mean(uncensored$ci), 3)
d01Hn <- round(mean(uncensored$d01), 3)
d02Hn <- round(mean(uncensored$d02), 3)
d03Hn <- round(mean(uncensored$d03), 3)
d04Hn <- round(mean(uncensored$d04), 3)
d05Hn <- round(mean(uncensored$d05), 3)
d06Hn <- round(mean(uncensored$d06), 3)
d07Hn <- round(mean(uncensored$d07), 3)
d08Hn <- round(mean(uncensored$d08), 3)
d09Hn <- round(mean(uncensored$d09), 3)
d10Hn <- round(mean(uncensored$d10), 3)

uncensoredM0Index <- sum(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn)
uncensoredFiveDE <- 1-uncensoredM0Index

# UncensoredP2 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

paste("IndicatorSum =", round(uncensoredM0Index, digits = 2))
paste("M0 =", round(ciM0, digits = 2))
cat("\nStatus:", ifelse(round(uncensoredM0Index, digits = 2) == round(ciM0, digits = 2), "PASSED", "FAILED"))

# ### Censoring the Inadequacies
# >Note: A respondent is identified as disempowered if ci > k and empowered if ci ≤ k. 
# > Censoring: If ci <= k the score is replaced by 0.")

library(dplyr)
censored <- (readRDS("_data/censored.rds") %>% filter(Phase == "P2", Sex == 2))
Hn <- mean(censored$cik)
cikM0 <- Hn
indexFiveDE <- 1 - cikM0

cikM0 <- round(mean(censored$cik), 3)
d01kHn <- round(mean(censored$d01k), 3)
d02kHn <- round(mean(censored$d02k), 3)
d03kHn <- round(mean(censored$d03k), 3)
d04kHn <- round(mean(censored$d04k), 3)
d05kHn <- round(mean(censored$d05k), 3)
d06kHn <- round(mean(censored$d06k), 3)
d07kHn <- round(mean(censored$d07k), 3)
d08kHn <- round(mean(censored$d08k), 3)
d09kHn <- round(mean(censored$d09k), 3)
d10kHn <- round(mean(censored$d10k), 3)

censoredM0Index <- sum(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn)
censoredFiveDE <- 1-censoredM0Index

# CensoredP2 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

paste("IndicatorSum =", round(censoredM0Index, digits = 2))
paste("M0 =", round(cikM0, digits = 2))
cat("\nStatus:", ifelse(round(censoredM0Index, digits = 2) == round(cikM0, digits = 2), "PASSED", "FAILED"))

### Tabulation and Plotting

IndicatorName <- c("Poultry  Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "Disempowered (M0)", "Empowered (5DE)" )
IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

UncensoredP2F <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

CensoredP2F <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

HCRatio <- data.frame(Indicator, UncensoredP2F, CensoredP2F)

HCRatio %>% head(12) %>% kable("html") %>% kable_styling(bootstrap_options = "basic", full_width = FALSE)


library(dplyr)
library(viridis)

p11 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "stack", width = .5, color = "#f1f1f1") + 
  labs(x = "Disempowerment Index", y = "Absolute Contribution", title = "", fill = "ColorCode") + 
  theme(axis.title.x = element_text(vjust = -1.5))

p12 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "fill", width = .5, color = "#f1f1f1") +
  labs(x = "Disempowerment Index", y = "Relative Contribution", title = "", fill = "Colorcode") +
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.title.x = element_text(vjust = -1.5))

# ggpubr::ggarrange(p11, p12, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")
```

<br>



<br>

### Men Phase 2
```{r}
uncensored <- (readRDS("_data/uncensored.rds") %>% filter(Phase == "P2", Sex == 1))

Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

ciM0 <- round(mean(uncensored$ci), 3)
d01Hn <- round(mean(uncensored$d01), 3)
d02Hn <- round(mean(uncensored$d02), 3)
d03Hn <- round(mean(uncensored$d03), 3)
d04Hn <- round(mean(uncensored$d04), 3)
d05Hn <- round(mean(uncensored$d05), 3)
d06Hn <- round(mean(uncensored$d06), 3)
d07Hn <- round(mean(uncensored$d07), 3)
d08Hn <- round(mean(uncensored$d08), 3)
d09Hn <- round(mean(uncensored$d09), 3)
d10Hn <- round(mean(uncensored$d10), 3)

uncensoredM0Index <- sum(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn)
uncensoredFiveDE <- 1-uncensoredM0Index

# UncensoredP2 <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

paste("IndicatorSum =", round(uncensoredM0Index, digits = 2))
paste("M0 =", round(ciM0, digits = 2))
cat("\nStatus:", ifelse(round(uncensoredM0Index, digits = 2) == round(ciM0, digits = 2), "PASSED", "FAILED"))

# ### Censoring the Inadequacies
# >Note: A respondent is identified as disempowered if ci > k and empowered if ci ≤ k. 
# > Censoring: If ci <= k the score is replaced by 0.")

library(dplyr)
censored <- (readRDS("_data/censored.rds") %>% filter(Phase == "P2", Sex == 2))
Hn <- mean(censored$cik)
cikM0 <- Hn
indexFiveDE <- 1 - cikM0

cikM0 <- round(mean(censored$cik), 3)
d01kHn <- round(mean(censored$d01k), 3)
d02kHn <- round(mean(censored$d02k), 3)
d03kHn <- round(mean(censored$d03k), 3)
d04kHn <- round(mean(censored$d04k), 3)
d05kHn <- round(mean(censored$d05k), 3)
d06kHn <- round(mean(censored$d06k), 3)
d07kHn <- round(mean(censored$d07k), 3)
d08kHn <- round(mean(censored$d08k), 3)
d09kHn <- round(mean(censored$d09k), 3)
d10kHn <- round(mean(censored$d10k), 3)

censoredM0Index <- sum(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn)
censoredFiveDE <- 1-censoredM0Index

# CensoredP2 <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

paste("IndicatorSum =", round(censoredM0Index, digits = 2))
paste("M0 =", round(cikM0, digits = 2))
cat("\nStatus:", ifelse(round(censoredM0Index, digits = 2) == round(cikM0, digits = 2), "PASSED", "FAILED"))

### Tabulation and Plotting

IndicatorName <- c("Poultry  Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "Disempowered (M0)", "Empowered (5DE)" )
IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )


Hn <- mean(uncensored$ci)
ciM0 <- Hn
indexFiveDE <- 1 - ciM0

UncensoredP2M <- c(d01Hn, d02Hn, d03Hn, d04Hn, d05Hn, d06Hn, d07Hn, d08Hn, d09Hn, d10Hn, uncensoredM0Index, uncensoredFiveDE)

CensoredP2M <- c(d01kHn, d02kHn, d03kHn, d04kHn, d05kHn, d06kHn, d07kHn, d08kHn, d09kHn, d10kHn, censoredM0Index, censoredFiveDE)

HCRatio <- data.frame(Indicator, UncensoredP2M, CensoredP2M)

HCRatio %>% head(12) %>% kable("html") %>% kable_styling(bootstrap_options = "basic", full_width = FALSE)

library(dplyr)
library(viridis)

p13 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "stack", width = .5, color = "#f1f1f1") + 
  labs(x = "Disempowerment Index", y = "Absolute Contribution", title = "", fill = "ColorCode") + 
  theme(axis.title.x = element_text(vjust = -1.5))

p14 <- HCRatio[1:10,] %>% 
  gather(key = "variable", value = value, -Indicator) %>% 
  ggplot(aes(x = variable, y = value, fill = Indicator)) +
  theme_bw() +
  scale_fill_viridis(discrete = TRUE) +
  geom_bar(stat = "identity", position = "fill", width = .5, color = "#f1f1f1") +
  labs(x = "Disempowerment Index", y = "Relative Contribution", title = "", fill = "Colorcode") +
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.title.x = element_text(vjust = -1.5))

# ggpubr::ggarrange(p13, p14, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")
```

```{r fig.height=6, fig.width=10}
ggpubr::ggarrange(p6, p8, "", "", p12, p14, ncol = 2, nrow = 3, common.legend = TRUE, legend = "right", labels = c("A: Female phase 1", "B: Male phase 1",  "", "", "C: Female phase 2", "D: Male phase 2"), heights = c(1, 0.05, 1))

```


<br>
<hr>
<br>

## Summary Table
```{r}
IndicatorName <- c("Poutry Production", "Livestock Production", "Land Ownership", "Assets on Land", "Earn Income", "Allowed to Sell or Buy Items", "Belong to Social Group", "Held Leadership Position", "Working Time", "Leisure Time", "M0", "FiveDE" )

IndicatorID <- c("D01", "D02", "D03", "D04", "D05", "D06", "D07", "D08", "D09", "D10", "M0", "5DE" )

disempowerStats <- data.frame(IndicatorID, IndicatorName, Uncensored, Censored, UncensoredP1, CensoredP1, UncensoredP2, CensoredP2, UncensoredP1F, UncensoredP1M, CensoredP1F, CensoredP1M, UncensoredP2F, UncensoredP2M, CensoredP2F, CensoredP2M)
head(disempowerStats)

saveRDS(disempowerStats, "_data/disempowerStats.rds")

### Combine Data

gathered <- disempowerStats %>% 
  gather(key = "variable", value = value, -c(IndicatorID, IndicatorName)) %>% 
  filter(IndicatorName != "M0",IndicatorName != "FiveDE")
saveRDS(gathered, "_data/gathered.rds")

gathered <- readRDS("_data/gathered.rds")
groupdata <- gathered %>% filter(variable %like% "ensoredP1F|ensoredP1M|ensoredP2F|ensoredP2M") %>% 
mutate(Sex = ifelse(variable == "UncensoredP1F"|variable == "CensoredP1F"|variable == "UncensoredP2F"| variable == "CensoredP2F", "Female", "Male"),
       Phase = ifelse(variable == "UncensoredP1F"|variable == "CensoredP1F"|variable == "UncensoredP1M"| variable == "CensoredP1M", "Phase1", "Phase2"),
       Year = ifelse(variable == "UncensoredP1F"|variable == "CensoredP1F"|variable == "UncensoredP1M"| variable == "CensoredP1M", 2018, 2019))

groupdata <- groupdata %>% 
  select("IndicatorID", "IndicatorName", "Phase", "Year", "Sex", "variable", "value" )

saveRDS(groupdata, "_data/groupdata.rds")
```

```{r}
groupdata <- readRDS("_data/groupdata.rds")
funModeling::df_status(groupdata)
funModeling::freq(groupdata)
```


